---
description: Rules when working with ingest files
globs: ingest/**
alwaysApply: false
---

# Ingest rules

- **Read-only**: All files under `ingest/` are read-only **except** `ingest/manifest.json` and `ingest/manifest.md`. The agent must not edit or delete any other file in `ingest/`.
- **Output targets**: When processing an ingest file (via the `ingest` or `ingest-force` skills), write processed content **only** to `sources/`, binary assets to `media/`, and update `ingest/manifest.json` and `ingest/manifest.md`. Never write processed content back to `ingest/` or `references/`.
- **Manifest Update**: After processing an ingest file, update `ingest/manifest.json` with the file's status (`ingested`, `error`), hash, produced `sources/` IDs, and `media/` paths. Then, regenerate `ingest/manifest.md` from the JSON for human readability.
- **Idempotent Re-processing**: Re-processing the same ingest file (especially via `ingest-force`) must **update** existing content under `sources/` and `media/` (using stable IDs and hashes); do not create duplicate source entries or media files. Preserve user-authored content within protected sections (e.g., `<!-- AGENT_PROTECTED_START -->` / `<!-- AGENT_PROTECTED_END -->`).
- **Source Corrections**: Before writing to `sources/`, read and apply normalization rules from `sources/corrections.md` (e.g., consistent spellings, canonical entity names).
