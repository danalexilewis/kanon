---
description: Rules when working with ingest files
globs: src/ingest/**
alwaysApply: false
---

# Ingest rules

- **Read-only**: All files under `src/ingest/` are read-only **except** `src/ingest/manifest.json` and `src/ingest/manifest.md`. The agent must not edit or delete any other file in `src/ingest/`.
- **Output targets**: When processing an ingest file (via the `ingest` or `ingest-force` skills), write processed content **only** to `src/sources/`, binary assets to `src/media/`, and update `src/ingest/manifest.json` and `src/ingest/manifest.md`. Never write processed content back to `src/ingest/` or `src/references/`.
- **Manifest Update**: After processing an ingest file, update `src/ingest/manifest.json` with the file's status (`ingested`, `error`), hash, produced `src/sources/` IDs, and `src/media/` paths. Use paths relative to repo root (e.g. `src/ingest/...`, `src/sources/...`). Then, regenerate `src/ingest/manifest.md` from the JSON for human readability.
- **Idempotent Re-processing**: Re-processing the same ingest file (especially via `ingest-force`) must **update** existing content under `src/sources/` and `src/media/` (using stable IDs and hashes); do not create duplicate source entries or media files. Preserve user-authored content within protected sections (e.g., `<!-- AGENT_PROTECTED_START -->` / `<!-- AGENT_PROTECTED_END -->`).
- **Source Corrections**: Before writing to `src/sources/`, read and apply normalization rules from `src/sources/corrections.md` (e.g., consistent spellings, canonical entity names).
